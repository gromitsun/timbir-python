158,164c158,159
< 	{
<         	temp = ErrorSino[i][j][k] * sqrt(TomoInputsPtr->Weight[i][j][k]);
< 		if (SinogramPtr->ProjSelect[i][j][k] == true)
< 			cost += temp*temp;
< 		else
< 			cost += 2*TomoInputsPtr->ErrorSinoDelta*TomoInputsPtr->ErrorSinoThresh*fabs(temp) + TomoInputsPtr->ErrorSinoThresh*TomoInputsPtr->ErrorSinoThresh*(1-2*TomoInputsPtr->ErrorSinoDelta);
< 	}
---
>         cost += (ErrorSino[i][j][k] * ErrorSino[i][j][k] * TomoInputsPtr->Weight[i][j][k]);
> 
284c279
<   Real_t UpdatedVoxelValue, ProjectionEntry, THETASelTemp;
---
>   Real_t UpdatedVoxelValue, ProjectionEntry;
431,452c426,438
< 			sino_view = ScannedObjectPtr->ProjIdxPtr[i_new][p];
< 			for (q = 0; q < AMatrixPtr[p].count; q++)
< 			{
<                	    		i_r = (AMatrixPtr[p].index[q]);
<         	    		ProjectionEntry = (AMatrixPtr[p].values[q]);
< 				for (r = 0; r < VoxelLineResponse[slice].count; r++)
< 				{ 
< 					i_t = VoxelLineResponse[slice].index[r];
< 					if (SinogramPtr->ProjSelect[sino_view][i_r][i_t] == true)
< 					{
< 	            				THETA2 += (VoxelLineResponse[slice].values[r]*VoxelLineResponse[slice].values[r]*ProjectionEntry*ProjectionEntry*TomoInputsPtr->Weight[sino_view][i_r][i_t]);
<                					THETA1 += -(ErrorSino[sino_view][i_r][i_t]*VoxelLineResponse[slice].values[r]*ProjectionEntry*TomoInputsPtr->Weight[sino_view][i_r][i_t]);
<             				}
< 					else
< 					{
< 						THETASelTemp = TomoInputsPtr->ErrorSinoThresh*TomoInputsPtr->ErrorSinoDelta*sqrt(TomoInputsPtr->Weight[sino_view][i_r][i_t])/fabs(ErrorSino[sino_view][i_r][i_t]);
< 	            				THETA2 += (VoxelLineResponse[slice].values[r]*VoxelLineResponse[slice].values[r]*ProjectionEntry*ProjectionEntry*THETASelTemp);
<                					THETA1 += -(ErrorSino[sino_view][i_r][i_t]*VoxelLineResponse[slice].values[r]*ProjectionEntry*THETASelTemp);
< 					}
< 				}
< 			}
<     		}
---
> 		sino_view = ScannedObjectPtr->ProjIdxPtr[i_new][p];
> 		for (q = 0; q < AMatrixPtr[p].count; q++)
> 		{
>                	    	i_r = (AMatrixPtr[p].index[q]);
>         	    	ProjectionEntry = (AMatrixPtr[p].values[q]);
> 			for (r = 0; r < VoxelLineResponse[slice].count; r++)
> 			{ 
> 				i_t = VoxelLineResponse[slice].index[r];
> 	            		THETA2 += (VoxelLineResponse[slice].values[r]*VoxelLineResponse[slice].values[r]*ProjectionEntry*ProjectionEntry*TomoInputsPtr->Weight[sino_view][i_r][i_t]);
>                			THETA1 += -(ErrorSino[sino_view][i_r][i_t]*VoxelLineResponse[slice].values[r]*ProjectionEntry*TomoInputsPtr->Weight[sino_view][i_r][i_t]);
>             		}
> 		}
>     }
472,476c458
< 	   			if (fabs(ErrorSino[sino_view][i_r][i_t]*sqrt(TomoInputsPtr->Weight[sino_view][i_r][i_t])) < TomoInputsPtr->ErrorSinoThresh)
< 					SinogramPtr->ProjSelect[sino_view][i_r][i_t] = true;
< 				else
< 					SinogramPtr->ProjSelect[sino_view][i_r][i_t] = false;
< 			}
---
> 	   		}
